name: 🚀 Craft CMS Auto Update & PR

on:
  schedule:
    - cron: '0 3 * * 0'  # Jeden Sonntag um 3 Uhr
  workflow_dispatch:
    inputs:
      update_type:
        description: 'Art des Updates'
        required: false
        default: 'manual'
        type: choice
        options:
          - manual
          - weekly-schedule
          - security-update
          - dependency-update
      triggered_by:
        description: 'Triggered by'
        required: false
        default: 'manual'
        type: choice
        options:
          - manual
          - n8n-automation
          - github-scheduler
          - security-alert
      target_repo:
        description: 'Target Repository'
        required: false
        default: 'craft-test-repo'

jobs:
  craft-update:
    name: 🔄 Craft Update & PR
    runs-on: ubuntu-latest
    
    steps:
    - name: 🔄 Repository auschecken
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        fetch-depth: 0

    - name: 📋 Workflow Info
      id: info
      run: |
        echo "🎯 Update Type: ${{ inputs.update_type || 'auto' }}"
        echo "🤖 Triggered by: ${{ inputs.triggered_by || 'github' }}"
        echo "📦 Target Repo: ${{ inputs.target_repo || 'craft-test-repo' }}"
        
        echo "update_type=${{ inputs.update_type || 'auto' }}" >> $GITHUB_OUTPUT
        echo "triggered_by=${{ inputs.triggered_by || 'github' }}" >> $GITHUB_OUTPUT

    # Hier kämen weitere Steps für Updates, Composer, PR-Erstellung usw.
    # Füge deine bestehenden Steps hinzu, z.B. für Backup, Composer update, etc.

    # Beispiel: PR erstellen
    - name: 🔄 Create Pull Request
      uses: peter-evans/create-pull-request@v5
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        commit-message: "🔄 Auto-update Craft CMS dependencies"
        title: "🔄 [AUTO] Weekly Craft CMS Update"
        body: "Automatisches Update via ${{ inputs.triggered_by }} - Type: ${{ inputs.update_type }}"
        branch: auto-update-${{ github.run_id }}
